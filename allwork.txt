// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: false,
  async redirects() {
    return [
      {
        source: '/',
        destination: '/dashboard',
        basePath: false,
        permanent: false,
      },
    ]
  },
}

module.exports = nextConfig

// app/api/auth/[...nextauth]/route.ts
import NextAuth from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'  // âœ… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯

const handler = NextAuth(authOptions)

export { handler as GET, handler as POST }

// app/api/auth/me/route.ts
import { NextResponse } from 'next/server'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'
import { prisma } from '@/lib/infrastructure/database/prisma'
import { successResponse, errorResponse } from '@/lib/infrastructure/auth/responses'
import { logger } from '@/lib/shared/logger'

// âœ… Ø£Ø¶Ù Ù‡Ø°Ø§ Ù„ØªØ­Ø¯ÙŠØ¯ Ø£Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
export const dynamic = 'force-dynamic'

export const GET = async () => {
  const requestId = `auth_me_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`

  try {
    logger.info({ requestId }, 'Fetching user data')

    const session = await getServerSession(authOptions)

    if (!session?.user?.id) {
      logger.warn({ requestId }, 'Unauthorized access to /api/auth/me')
      return NextResponse.json(
        errorResponse('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'UNAUTHORIZED'),
        { status: 401 }
      )
    }

    const user = await prisma.user.findUnique({
      where: { id: session.user.id },
      select: {
        id: true,
        name: true,
        email: true,
        phoneNumber: true,
        age: true,
        description: true,
        skillLevel: true,
        role: true,
        isVerified: true,
        isActive: true,
        lastLogin: true,
        createdAt: true,
        updatedAt: true,
      }
    })

    if (!user) {
      logger.warn({ requestId, userId: session.user.id }, 'User not found')
      return NextResponse.json(
        errorResponse('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'USER_NOT_FOUND'),
        { status: 404 }
      )
    }

    if (!user.isActive) {
      logger.warn({ requestId, userId: user.id }, 'Inactive account accessed')
      return NextResponse.json(
        errorResponse('Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù†Ø´Ø·', 'ACCOUNT_INACTIVE'),
        { status: 403 }
      )
    }

    logger.info({ requestId, userId: user.id }, 'User data fetched successfully')

    return NextResponse.json(
      successResponse('ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', {
        user: {
          ...user,
          lastLogin: user.lastLogin?.toISOString(),
          createdAt: user.createdAt.toISOString(),
          updatedAt: user.updatedAt.toISOString()
        }
      }, '/api/auth/me')
    )

  } catch (error: any) {
    logger.error('Error in /api/auth/me', error, { requestId })
    return NextResponse.json(
      errorResponse('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'INTERNAL_ERROR'),
      { status: 500 }
    )
  }
}

// app/api/auth/register/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { RateLimiterMemory } from 'rate-limiter-flexible'
import { prisma } from '@/lib/infrastructure/database/prisma'  
import { hashPassword } from '@/lib/infrastructure/security/password'
import { z } from 'zod'
import { logger } from '@/lib/shared/logger'

// Rate Limiter Ù„Ù„ØªØ³Ø¬ÙŠÙ„
const registerRateLimiter = new RateLimiterMemory({
  points: 3,
  duration: 60 * 60,
  blockDuration: 60 * 60,
})

// ğŸ”´ Ø¥ØµÙ„Ø§Ø­: ØªØºÙŠÙŠØ± age Ù…Ù† number Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®
const registerSchema = z.object({
  name: z.string().min(2, 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'),
  email: z.string().email('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­'),
  password: z.string()
    .min(6, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
    .max(72, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹'),
  phoneNumber: z.string().min(10, 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­'),
  // ğŸ”´ Ø§Ù„Ø­Ù„ 1: Ù‚Ø¨ÙˆÙ„ string ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù€ Date
  age: z.string().or(z.number()).transform((val) => {
    if (typeof val === 'number') {
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù… (Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯)ØŒ Ø£Ù†Ø´Ø¦ ØªØ§Ø±ÙŠØ® 1 ÙŠÙ†Ø§ÙŠØ± Ù…Ù† ØªÙ„Ùƒ Ø§Ù„Ø³Ù†Ø©
      return new Date(`${val}-01-01`)
    }
    // Ø¥Ø°Ø§ ÙƒØ§Ù† stringØŒ Ø­Ø§ÙˆÙ„ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù€ Date
    const date = new Date(val)
    if (isNaN(date.getTime())) {
      throw new Error('Ø§Ù„Ø¹Ù…Ø± ØºÙŠØ± ØµØ§Ù„Ø­')
    }
    return date
  }).refine((date) => {
    // ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ø¹Ù…Ø± 13 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
    const minAgeDate = new Date()
    minAgeDate.setFullYear(minAgeDate.getFullYear() - 13)
    return date <= minAgeDate
  }, 'Ø§Ù„Ø¹Ù…Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 13 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'),
  skillLevel: z.enum(['WEAK', 'AVERAGE', 'GOOD', 'EXCELLENT', 'LEGENDARY'])
})

// ğŸ”´ Ø§Ù„Ø­Ù„ 2: Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… year of birth Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† age
const registerSchemaAlt = z.object({
  name: z.string().min(2, 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'),
  email: z.string().email('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­'),
  password: z.string()
    .min(6, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
    .max(72, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹'),
  phoneNumber: z.string().min(10, 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­'),
  // Ø§Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù…Ù† Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
  birthYear: z.number()
    .min(1900, 'Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­Ø©')
    .max(new Date().getFullYear() - 13, 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù…Ø±Ùƒ 13 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
    .transform((year) => new Date(`${year}-01-01`)),
  skillLevel: z.enum(['WEAK', 'AVERAGE', 'GOOD', 'EXCELLENT', 'LEGENDARY'])
})

// ğŸ”´ Ø§Ù„Ø­Ù„ 3: Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… date string Ù…Ø¨Ø§Ø´Ø±Ø©
const registerSchemaSimple = z.object({
  name: z.string().min(2, 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'),
  email: z.string().email('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­'),
  password: z.string()
    .min(6, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
    .max(72, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹'),
  phoneNumber: z.string().min(10, 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­'),
  // Ù‚Ø¨ÙˆÙ„ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ ÙƒÙ€ string
  dateOfBirth: z.string()
    .refine((date) => {
      const d = new Date(date)
      return !isNaN(d.getTime())
    }, 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­')
    .transform((date) => new Date(date))
    .refine((date) => {
      const minAgeDate = new Date()
      minAgeDate.setFullYear(minAgeDate.getFullYear() - 13)
      return date <= minAgeDate
    }, 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù…Ø±Ùƒ 13 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'),
  skillLevel: z.enum(['WEAK', 'AVERAGE', 'GOOD', 'EXCELLENT', 'LEGENDARY'])
})

const normalizeEmail = (email: string): string => {
  return email.toLowerCase().trim()
}

const checkRegisterRateLimit = async (ip: string) => {
  try {
    await registerRateLimiter.consume(ip)
    return { allowed: true }
  } catch (rateLimiterRes: any) {
    const retryAfter = Math.ceil(rateLimiterRes.msBeforeNext / 1000) || 60
    throw new Error(`Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ ${retryAfter} Ø«Ø§Ù†ÙŠØ©`)
  }
}

const getClientIp = (request: NextRequest): string => {
  const forwardedFor = request.headers.get('x-forwarded-for')
  const realIp = request.headers.get('x-real-ip')
  
  if (forwardedFor) {
    return forwardedFor.split(',')[0].trim()
  }
  
  return realIp || 'unknown'
}

export async function POST(request: NextRequest) {
  const requestId = `register_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
  
  try {
    logger.info({ requestId }, 'Registration attempt')
    
    const clientIp = getClientIp(request)
    await checkRegisterRateLimit(clientIp)
    
    const body = await request.json()
    
    // ğŸ”´ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø­Ø¯ Ø§Ù„Ù€ schemas Ø£Ø¹Ù„Ø§Ù‡
    const validatedData = registerSchema.parse(body) // Ø£Ùˆ registerSchemaAlt Ø£Ùˆ registerSchemaSimple

    const normalizedEmail = normalizeEmail(validatedData.email)

    const existingUser = await prisma.user.findUnique({
      where: { email: normalizedEmail }
    })

    if (existingUser) {
      logger.warn({ requestId, email: normalizedEmail }, 'Email already exists')
      return NextResponse.json(
        { 
          success: false,
          error: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
          code: 'EMAIL_ALREADY_EXISTS'
        },
        { status: 409 }
      )
    }

    const existingPhone = await prisma.user.findUnique({
      where: { phoneNumber: validatedData.phoneNumber }
    })

    if (existingPhone) {
      logger.warn({ requestId, phone: validatedData.phoneNumber }, 'Phone already exists')
      return NextResponse.json(
        { 
          success: false,
          error: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
          code: 'PHONE_ALREADY_EXISTS'
        },
        { status: 409 }
      )
    }

    const hashedPassword = await hashPassword(validatedData.password)

    const user = await prisma.user.create({
      data: {
        name: validatedData.name,
        email: normalizedEmail,
        passwordHash: hashedPassword,
        phoneNumber: validatedData.phoneNumber,
        age: validatedData.age, // Ø§Ù„Ø¢Ù† Ù‡Ø°Ø§ Date ÙˆÙ„ÙŠØ³ number
        skillLevel: validatedData.skillLevel,
        role: 'PLAYER',
        isActive: true,
        isVerified: false
      }
    })

    logger.info({ requestId, userId: user.id }, 'Registration successful')
    
    return NextResponse.json({
      success: true,
      message: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­',
      data: {
        id: user.id,
        name: user.name,
        email: user.email,
        requiresVerification: true
      }
    }, { status: 201 })

  } catch (error: any) {
    if (error.name === 'ZodError') {
      const firstError = error.errors[0]
      logger.warn({ requestId, error: firstError.message }, 'Validation error in registration')
      return NextResponse.json(
        { 
          success: false,
          error: firstError.message,
          code: 'VALIDATION_ERROR'
        },
        { status: 400 }
      )
    }

    if (error.message.includes('Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­')) {
      logger.warn({ requestId, error: error.message }, 'Rate limit exceeded')
      return NextResponse.json(
        { 
          success: false,
          error: error.message,
          code: 'RATE_LIMIT_EXCEEDED'
        },
        { status: 429 }
      )
    }

    logger.error('Registration error', error, { requestId })
    return NextResponse.json(
      { 
        success: false,
        error: 'ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨',
        code: 'INTERNAL_SERVER_ERROR'
      },
      { status: 500 }
    )
  }
}

// app/page.tsx
import { redirect } from 'next/navigation'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'
import Header from '@/components/layout/header'
import Footer from '@/components/layout/footer'
import HeroSection from '@/components/home/hero-section'
import FeaturedFields from '@/components/home/featured-fields'
import HowItWorks from '@/components/home/how-it-works'
import MainCardsGrid from '@/components/home/main-cards-grid'

export default async function HomePage() {
  const session = await getServerSession(authOptions)
  
  // ğŸ”´ Ø§Ù„Ø­Ù„: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ Ù…Ø¹ /dashboard
  if (session) {
    redirect('/dashboard')
  }
  
  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white">
      <Header />
      <main className="container mx-auto px-4 py-8">
        {/* ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ... */}
      </main>
      <Footer />
    </div>
  )
}

//app/layout.tsx
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'
import AuthProvider from '@/components/providers/Authprovider'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Ø§Ø­Ø¬Ø²Ù„ÙŠ - Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨',
  description: 'Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="ar" dir="rtl">
      <body className={inter.className}>
        <AuthProvider>
          {children}
        </AuthProvider>
      </body>
    </html>
  )
}

//app/(auth)/layout.tsx
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©',
  description: 'Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©',
}

export default function AuthLayout({ 
  children 
}: { 
  children: React.ReactNode 
}) {
  return (
    <div className="min-h-screen">
      {children}
    </div>
  )
}

// app/(auth)/register/page.tsx
'use client'

import { useState } from 'react'
import Link from 'next/link'
import { useRouter } from 'next/navigation'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { registerSchema, type RegisterInput } from '@/lib/infrastructure/auth/validators' // âœ… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
import { 
  User, Mail, Lock, Phone, Calendar, Star, FileText, ShieldCheck, Check, X, 
  Sparkles, Target, Trophy 
} from 'lucide-react'
import Button from '@/components/ui/button'
import Input from '@/components/ui/input'
import Alert from '@/components/ui/alert'
import { cn } from '@/lib/shared/helpers' // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù

export default function RegisterPage() {
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState('')
  const [skillLevel, setSkillLevel] = useState<'WEAK' | 'AVERAGE' | 'GOOD' | 'EXCELLENT' | 'LEGENDARY'>('AVERAGE')
  const router = useRouter()
  
  const {
    register,
    handleSubmit,
    formState: { errors },
    watch,
    setValue
  } = useForm<RegisterInput>({
    resolver: zodResolver(registerSchema),
    defaultValues: {
      name: '',
      email: '',
      password: '',
      confirmPassword: '',
      phoneNumber: '',
      age: undefined,
      description: '',
      skillLevel: 'AVERAGE'
    }
  })

  // âœ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© useAuth() ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… fetch Ù…Ø¨Ø§Ø´Ø±Ø©
  const registerUser = async (data: RegisterInput) => {
    const response = await fetch('/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    if (!result.success) throw new Error(result.error);
    
    // Redirect to login
    router.push('/login?registered=true');
  };

  const password = watch('password')
  const confirmPassword = watch('confirmPassword')
  const description = watch('description')

  // âœ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø³ÙŠØ§Ø³Ø© Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù…Ø¨Ø³Ø·Ø© (6 Ø£Ø­Ø±Ù ÙÙ‚Ø·)
  const passwordChecks = [
    { label: '6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', check: password?.length >= 6 },
    { label: 'Ø£Ù‚Ù„ Ù…Ù† 72 Ø­Ø±ÙØ§Ù‹', check: password?.length <= 72 },
  ];

  const onSubmit = async (data: RegisterInput) => {
    setIsLoading(true)
    setError('')
    
    try {
      // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      await registerUser(data)
    } catch (err: any) {
      setError(err.message || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„')
    } finally {
      setIsLoading(false)
    }
  }

  const skillLevels = [
    { value: 'WEAK' as const, label: 'Ø¶Ø¹ÙŠÙ', desc: 'Ù…Ø¨ØªØ¯Ø¦', icon: 'ğŸ˜…' },
    { value: 'AVERAGE' as const, label: 'Ù…ØªÙˆØ³Ø·', desc: 'Ù„Ø¯ÙŠÙ‡ Ø®Ø¨Ø±Ø©', icon: 'ğŸ˜Š' },
    { value: 'GOOD' as const, label: 'Ø¬ÙŠØ¯', desc: 'Ù…ØªÙ…ÙƒÙ†', icon: 'ğŸ˜' },
    { value: 'EXCELLENT' as const, label: 'Ù…Ù…ØªØ§Ø²', desc: 'Ù…Ø­ØªØ±Ù', icon: 'ğŸ”¥' },
    { value: 'LEGENDARY' as const, label: 'Ø£Ø³Ø·ÙˆØ±ÙŠ', desc: 'Ø®Ø¨ÙŠØ±', icon: 'ğŸ‘‘' }
  ]

  const passwordStrength = passwordChecks.filter(check => check.check).length
  const strengthPercentage = (passwordStrength / 2) * 100
  const strengthColor = passwordStrength <= 1 ? 'red' : 'green'
  const strengthText = passwordStrength <= 1 ? 'Ø¶Ø¹ÙŠÙØ©' : 'Ø¬ÙŠØ¯Ø©'

  const selectedSkill = skillLevels.find(level => level.value === skillLevel)

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900">
      {/* Animated Background Elements */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        <div className="absolute -top-40 -right-40 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl" />
        <div className="absolute top-1/3 -left-40 w-80 h-80 bg-purple-500/10 rounded-full blur-3xl" />
        <div className="absolute bottom-40 right-1/4 w-60 h-60 bg-pink-500/10 rounded-full blur-3xl" />
      </div>

      <div className="container mx-auto px-4 py-8 relative">
        <div className="flex flex-col lg:flex-row gap-8">
          {/* Left Side - Welcome & Features */}
          <div className="lg:w-2/5 flex flex-col justify-center text-white p-6 lg:p-12">
            <div className="mb-12">
              <div className="inline-flex items-center gap-3 mb-6">
                <div className="p-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-2xl">
                  <Sparkles className="w-10 h-10 text-white" />
                </div>
                <div>
                  <h1 className="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400">
                    Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ
                  </h1>
                  <p className="text-2xl font-semibold text-gray-300 mt-2">ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</p>
                </div>
              </div>
              <p className="text-xl text-gray-300 leading-relaxed">
                Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø¢Ù„Ø§Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„ØªÙ…ÙŠØ². 
                Ø£Ù†Ø´Ø¦ Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ§ÙƒØªØ´Ù Ø¹Ø§Ù„Ù…Ø§Ù‹ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª.
              </p>
            </div>
            
            <div className="space-y-6">
              {/* Feature 1 */}
              <div className="bg-gradient-to-r from-white/5 to-white/0 p-6 rounded-2xl border border-white/10 backdrop-blur-sm hover:border-white/20 transition-all duration-300">
                <div className="flex items-center gap-4">
                  <div className="p-3 bg-gradient-to-br from-blue-500/30 to-blue-600/30 rounded-xl">
                    <ShieldCheck className="w-8 h-8 text-blue-400" />
                  </div>
                  <div>
                    <h3 className="text-xl font-semibold text-white">ØªØ³Ø¬ÙŠÙ„ Ø³Ù‡Ù„</h3>
                    <p className="text-gray-400 mt-1">ØªØ³Ø¬ÙŠÙ„ Ø¨Ø³ÙŠØ· Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯Ø§Øª</p>
                  </div>
                </div>
              </div>
              
              {/* Feature 2 */}
              <div className="bg-gradient-to-r from-white/5 to-white/0 p-6 rounded-2xl border border-white/10 backdrop-blur-sm hover:border-white/20 transition-all duration-300">
                <div className="flex items-center gap-4">
                  <div className="p-3 bg-gradient-to-br from-purple-500/30 to-purple-600/30 rounded-xl">
                    <Target className="w-8 h-8 text-purple-400" />
                  </div>
                  <div>
                    <h3 className="text-xl font-semibold text-white">ØªØ­Ø¯ÙŠØ§Øª Ù…Ù†Ø§Ø³Ø¨Ø©</h3>
                    <p className="text-gray-400 mt-1">ØªØ­Ø¯ÙŠØ§Øª ØªÙ„Ø§Ø¦Ù… Ù…Ø³ØªÙˆØ§Ùƒ ÙˆØªØ·ÙˆØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ</p>
                  </div>
                </div>
              </div>
              
              {/* Feature 3 */}
              <div className="bg-gradient-to-r from-white/5 to-white/0 p-6 rounded-2xl border border-white/10 backdrop-blur-sm hover:border-white/20 transition-all duration-300">
                <div className="flex items-center gap-4">
                  <div className="p-3 bg-gradient-to-br from-green-500/30 to-green-600/30 rounded-xl">
                    <Trophy className="w-8 h-8 text-green-400" />
                  </div>
                  <div>
                    <h3 className="text-xl font-semibold text-white">Ø§Ù†Ø¬Ø§Ø²Ø§Øª ÙˆØ¬ÙˆØ§Ø¦Ø²</h3>
                    <p className="text-gray-400 mt-1">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ¢Øª ÙˆØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù…Ø±Ø§ØªØ¨</p>
                  </div>
                </div>
              </div>
            </div>

            {/* Stats */}
            <div className="mt-12 grid grid-cols-3 gap-4">
              <div className="text-center p-4 bg-white/5 rounded-xl border border-white/10">
                <div className="text-2xl font-bold text-white">10K+</div>
                <div className="text-sm text-gray-400 mt-1">Ù„Ø§Ø¹Ø¨ Ù†Ø´Ø·</div>
              </div>
              <div className="text-center p-4 bg-white/5 rounded-xl border border-white/10">
                <div className="text-2xl font-bold text-white">500+</div>
                <div className="text-sm text-gray-400 mt-1">ØªØ­Ø¯ÙŠ ÙŠÙˆÙ…ÙŠ</div>
              </div>
              <div className="text-center p-4 bg-white/5 rounded-xl border border-white/10">
                <div className="text-2xl font-bold text-white">99%</div>
                <div className="text-sm text-gray-400 mt-1">Ø±Ø¶Ø§ Ø¹Ù…Ù„Ø§Ø¡</div>
              </div>
            </div>
          </div>

          {/* Right Side - Registration Form */}
          <div className="lg:w-3/5">
            <div className="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl border border-white/20 rounded-3xl shadow-2xl overflow-hidden">
              {/* Form Header */}
              <div className="p-8 border-b border-white/10">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-3xl font-bold text-white">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                    <p className="text-gray-300 mt-2">Ø§Ù…Ù„Ø£ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ø¨Ø¯Ø¡ Ø±Ø­Ù„ØªÙƒ</p>
                  </div>
                  <div className="flex items-center gap-2 px-4 py-2 bg-white/10 rounded-full">
                    <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse" />
                    <span className="text-sm text-gray-300">Ù†Ø¸Ø§Ù… Ø¢Ù…Ù†</span>
                  </div>
                </div>
              </div>

              {/* Form Content */}
              <div className="p-8">
                {error && (
                  <Alert 
                    type="error" 
                    title="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„" 
                    message={error} 
                    className="mb-6 animate-in slide-in-from-top duration-300"
                  />
                )}

                <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
                  {/* Personal Information */}
                  <div>
                    <div className="flex items-center gap-3 mb-6">
                      <div className="p-2 bg-blue-500/20 rounded-lg">
                        <User className="w-5 h-5 text-blue-400" />
                      </div>
                      <h3 className="text-xl font-semibold text-white">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <Input
                        label="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
                        type="text"
                        placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"
                        error={errors.name?.message}
                        icon={<User className="w-5 h-5" />}
                        {...register('name')}
                        disabled={isLoading}
                      />

                      <Input
                        label="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                        type="email"
                        placeholder="ahmed@example.com"
                        error={errors.email?.message}
                        icon={<Mail className="w-5 h-5" />}
                        {...register('email')}
                        disabled={isLoading}
                      />

                      <Input
                        label="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"
                        type="tel"
                        placeholder="+20 100 000 0000"
                        error={errors.phoneNumber?.message}
                        icon={<Phone className="w-5 h-5" />}
                        {...register('phoneNumber')}
                        disabled={isLoading}
                      />

                      <Input
                        label="Ø§Ù„Ø¹Ù…Ø±"
                        type="number"
                        placeholder="25"
                        min="13"
                        max="100"
                        error={errors.age?.message}
                        icon={<Calendar className="w-5 h-5" />}
                        {...register('age', { valueAsNumber: true })}
                        disabled={isLoading}
                      />
                    </div>
                  </div>

                  {/* Password Section */}
                  <div>
                    <div className="flex items-center gap-3 mb-6">
                      <div className="p-2 bg-purple-500/20 rounded-lg">
                        <Lock className="w-5 h-5 text-purple-400" />
                      </div>
                      <h3 className="text-xl font-semibold text-white">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                      <span className="text-sm text-gray-400">(Ø³ÙŠØ§Ø³Ø© Ø¨Ø³ÙŠØ·Ø© - 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)</span>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <Input
                        label="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                        type="password"
                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                        error={errors.password?.message}
                        icon={<Lock className="w-5 h-5" />}
                        {...register('password')}
                        disabled={isLoading}
                      />

                      <Input
                        label="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                        type="password"
                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                        error={errors.confirmPassword?.message}
                        icon={<Lock className="w-5 h-5" />}
                        {...register('confirmPassword')}
                        disabled={isLoading}
                      />
                    </div>

                    {/* Password Strength */}
                    {password && (
                      <div className="mt-6 p-5 bg-gradient-to-r from-white/5 to-white/0 rounded-xl border border-white/10">
                        <div className="flex items-center justify-between mb-4">
                          <div className="flex items-center gap-2">
                            <ShieldCheck className="w-5 h-5 text-white" />
                            <span className="text-white font-medium">Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</span>
                          </div>
                          <span className={cn(
                            "text-sm font-semibold",
                            strengthColor === 'red' ? 'text-red-400' : 'text-green-400'
                          )}>
                            {strengthText}
                          </span>
                        </div>
                        
                        <div className="space-y-3">
                          <div className="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div 
                              className={cn(
                                "h-full transition-all duration-500",
                                strengthColor === 'red' ? 'bg-red-500' : 'bg-green-500'
                              )}
                              style={{ width: `${strengthPercentage}%` }}
                            />
                          </div>
                          
                          <div className="grid grid-cols-2 gap-2">
                            {passwordChecks.map((check, index) => (
                              <div 
                                key={index}
                                className={cn(
                                  "flex items-center gap-2 text-xs p-2 rounded-lg transition-all duration-300",
                                  check.check 
                                    ? 'bg-green-500/20 text-green-300 border border-green-500/30' 
                                    : 'bg-red-500/10 text-red-300 border border-red-500/20'
                                )}
                              >
                                {check.check ? (
                                  <Check className="w-3 h-3 text-green-400" />
                                ) : (
                                  <X className="w-3 h-3 text-red-400" />
                                )}
                                <span>{check.label}</span>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* Password Match Check */}
                        {password && confirmPassword && (
                          <div className="mt-4 p-3 rounded-lg bg-white/5">
                            <div className={cn(
                              "flex items-center gap-2 text-sm",
                              password === confirmPassword 
                                ? 'text-green-400' 
                                : 'text-red-400'
                            )}>
                              {password === confirmPassword ? (
                                <Check className="w-4 h-4" />
                              ) : (
                                <X className="w-4 h-4" />
                              )}
                              <span>
                                {password === confirmPassword 
                                  ? 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©' 
                                  : 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©'}
                              </span>
                            </div>
                          </div>
                        )}
                      </div>
                    )}
                  </div>

                  {/* Skill Level */}
                  <div>
                    <div className="flex items-center gap-3 mb-6">
                      <div className="p-2 bg-orange-500/20 rounded-lg">
                        <Star className="w-5 h-5 text-orange-400" />
                      </div>
                      <h3 className="text-xl font-semibold text-white">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</h3>
                    </div>
                    
                    <div className="mb-4">
                      <p className="text-gray-300 text-sm">
                        Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ù…Ù‡Ø§Ø±ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„ØªÙ„Ø§Ø¦Ù…Ùƒ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
                      </p>
                    </div>
                    
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                      {skillLevels.map((level: any) => (
                        <button
                          type="button"
                          key={level.value}
                          onClick={() => {
                            setSkillLevel(level.value)
                            setValue('skillLevel', level.value)
                          }}
                          className={cn(
                            "relative flex flex-col items-center p-4 rounded-xl border-2 transition-all duration-300",
                            "transform hover:scale-105 active:scale-95",
                            skillLevel === level.value 
                              ? 'border-white shadow-lg scale-105 bg-gradient-to-br from-orange-500/30 to-orange-600/30' 
                              : 'border-white/20 bg-white/5 hover:bg-white/10 hover:border-white/30'
                          )}
                        >
                          <div className="text-2xl mb-2">{level.icon}</div>
                          <div className="text-sm font-semibold text-white">{level.label}</div>
                          <div className="text-xs text-white/70 mt-1">{level.desc}</div>
                        </button>
                      ))}
                    </div>
                    
                    {selectedSkill && skillLevel === selectedSkill.value && (
                      <div className="mt-4 p-4 bg-gradient-to-r from-white/5 to-white/0 rounded-xl border border-white/10">
                        <div className="flex items-center gap-3">
                          <div className="p-2 bg-white/10 rounded-lg">
                            <span className="text-xl">{selectedSkill.icon}</span>
                          </div>
                          <div>
                            <h4 className="text-white font-medium">Ù…Ø³ØªÙˆÙ‰ {selectedSkill.label}</h4>
                            <p className="text-gray-300 text-sm mt-1">
                              {selectedSkill.desc} - Ø³ØªØªÙ„Ù‚Ù‰ ØªØ­Ø¯ÙŠØ§Øª Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù…Ø³ØªÙˆØ§Ùƒ
                            </p>
                          </div>
                        </div>
                      </div>
                    )}
                    
                    {errors.skillLevel?.message && (
                      <p className="text-sm text-red-400 mt-3">{errors.skillLevel.message}</p>
                    )}
                  </div>

                  {/* Description */}
                  <div>
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-2 bg-pink-500/20 rounded-lg">
                        <FileText className="w-5 h-5 text-pink-400" />
                      </div>
                      <div>
                        <h3 className="text-xl font-semibold text-white">Ø§Ù„ÙˆØµÙ Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                        <p className="text-gray-300 text-sm">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø´Ø§Ø±ÙƒÙ†Ø§ Ø´ÙŠØ¦Ø§Ù‹ Ø¹Ù† Ù†ÙØ³Ùƒ</p>
                      </div>
                    </div>
                    
                    <textarea
                      placeholder="Ø£Ø®Ø¨Ø±Ù†Ø§ Ø¹Ù† Ù†ÙØ³ÙƒØŒ Ù‡ÙˆØ§ÙŠØ§ØªÙƒØŒ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒØŒ ÙˆÙ…Ù‡Ø§Ø±Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨..."
                      rows={3}
                      maxLength={500}
                      {...register('description')}
                      disabled={isLoading}
                      className="w-full px-4 py-3 bg-white/5 border border-white/20 rounded-xl
                               text-white placeholder-gray-400 focus:outline-none 
                               focus:ring-2 focus:ring-blue-500 focus:border-transparent
                               transition-all resize-none"
                    />
                    <div className="flex justify-between items-center mt-2">
                      <div className="text-xs text-gray-400">
                        {description?.length || 0} / 500 Ø­Ø±Ù
                      </div>
                      <div className={cn(
                        "text-xs font-medium",
                        (description?.length || 0) >= 450 
                          ? 'text-orange-400 animate-pulse' 
                          : 'text-gray-400'
                      )}>
                        {description && description.length >= 450 && 'Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰'}
                      </div>
                    </div>
                  </div>

                  {/* Terms & Conditions */}
                  <div className="p-5 bg-gradient-to-r from-white/5 to-white/0 rounded-xl border border-white/10">
                    <div className="flex items-start gap-4">
                      <input
                        type="checkbox"
                        id="terms"
                        className="mt-1 w-5 h-5 rounded border-white/30 bg-white/10 
                                 text-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900"
                        required
                      />
                      <div>
                        <label htmlFor="terms" className="text-gray-300 text-sm leading-relaxed">
                          Ø£Ù†Ø§ Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹{' '}
                          <Link 
                            href="/terms" 
                            className="text-blue-400 hover:text-blue-300 underline hover:no-underline font-medium"
                          >
                            Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…
                          </Link>{' '}
                          Ùˆ{' '}
                          <Link 
                            href="/privacy" 
                            className="text-blue-400 hover:text-blue-300 underline hover:no-underline font-medium"
                          >
                            Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
                          </Link>{' '}
                          Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù†ØµØ©. Ø£Ù‚Ø± Ø¨Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ø¯Ù…ØªÙ‡Ø§ ØµØ­ÙŠØ­Ø© ÙˆØ£ØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¹Ù†Ù‡Ø§.
                        </label>
                      </div>
                    </div>
                  </div>

                  {/* Submit Button */}
                  <Button
                    type="submit"
                    className="w-full py-4 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500
                             hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 
                             text-white font-bold text-lg rounded-xl shadow-2xl
                             transform hover:-translate-y-1 active:translate-y-0
                             transition-all duration-300"
                    loading={isLoading}
                    disabled={isLoading}
                  >
                    {isLoading ? (
                      <span className="flex items-center justify-center gap-2">
                        <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                        Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...
                      </span>
                    ) : (
                      <span className="flex items-center justify-center gap-2">
                        <Sparkles className="w-5 h-5" />
                        Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ÙŠ ÙˆØ§Ù„Ø¨Ø¯Ø¡
                      </span>
                    )}
                  </Button>
                </form>

                {/* Login Link */}
                <div className="mt-8 pt-6 border-t border-white/10">
                  <p className="text-center text-gray-300 text-sm">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ{' '}
                    <Link
                      href="/login"
                      className="font-bold text-blue-400 hover:text-blue-300 
                               underline hover:no-underline transition-all duration-300
                               hover:tracking-wider"
                    >
                      ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </Link>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}

//app/(auth)/login/page.tsx
import { Suspense } from 'react'
import LoginContent from './LoginContent'

export default function LoginPage() {
  return (
    <Suspense fallback={<LoginSkeleton />}>
      <LoginContent />
    </Suspense>
  )
}

function LoginSkeleton() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4">
      <div className="w-full max-w-md">
        <div className="text-center mb-8">
          <div className="inline-block p-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl mb-4 animate-pulse">
            <div className="w-12 h-12"></div>
          </div>
          <h1 className="text-4xl font-bold text-white mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!</h1>
          <p className="text-gray-300">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„...</p>
        </div>
      </div>
    </div>
  )
}

//app/(auth)/login/loginContent.tsx
'use client'

import { useState } from 'react'
import Link from 'next/link'
import { useRouter, useSearchParams } from 'next/navigation'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { signIn } from 'next-auth/react'
import { loginSchema, type LoginInput } from '@/lib/infrastructure/auth/validators'
import { LogIn, Mail, Lock, Gamepad2 } from 'lucide-react'
import { FcGoogle } from 'react-icons/fc'
import Button from '@/components/ui/button'
import Input from '@/components/ui/input'
import Card from '@/components/ui/card'
import Alert from '@/components/ui/alert'
import toast from 'react-hot-toast'

export default function LoginContent() {
  const [isLoading, setIsLoading] = useState(false)
  const [googleLoading, setGoogleLoading] = useState(false)
  const [error, setError] = useState('')
  const router = useRouter()
  const searchParams = useSearchParams()
  
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<LoginInput>({
    resolver: zodResolver(loginSchema),
    defaultValues: {
      email: '',
      password: ''
    }
  })

  const onSubmit = async (data: LoginInput) => {
    setIsLoading(true)
    setError('')
    
    try {
      const result = await signIn('credentials', {
        email: data.email,
        password: data.password,
        redirect: false,
      })

      if (result?.error) {
        toast.error(result.error)
        setError(result.error)
      } else if (result?.ok) {
        toast.success('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­')
        router.push('/dashboard')
        router.refresh()
      }
    } catch (err: any) {
      toast.error(err.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')
      setError(err.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')
    } finally {
      setIsLoading(false)
    }
  }

  const handleGoogleSignIn = async () => {
    setGoogleLoading(true)
    setError('')
    
    try {
      const result = await signIn('google', {
        redirect: false,
        callbackUrl: '/dashboard'
      })
      
      if (result?.error) {
        toast.error(result.error)
        setError(result.error)
      } else if (result?.ok) {
        toast.success('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­')
        router.push('/dashboard')
        router.refresh()
      }
    } catch (err: any) {
      toast.error(err.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„')
      setError(err.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„')
    } finally {
      setGoogleLoading(false)
    }
  }

  const redirect = searchParams.get('redirect')
  const registered = searchParams.get('registered')
  const accountError = searchParams.get('error')

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4">
      <div className="w-full max-w-md">
        <div className="text-center mb-8">
          <div className="inline-block p-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl mb-4">
            <Gamepad2 className="w-12 h-12 text-white" />
          </div>
          <h1 className="text-4xl font-bold text-white mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!</h1>
          <p className="text-gray-300">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</p>
        </div>

        <Card className="p-8 bg-white/10 backdrop-blur-lg border border-white/20">
          {registered && (
            <Alert 
              type="success" 
              title="ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­" 
              message="ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ÙƒØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†" 
              className="mb-6"
            />
          )}

          {redirect && (
            <Alert 
              type="info" 
              title="Ù…Ø·Ù„ÙˆØ¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„" 
              message="ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©" 
              className="mb-6"
            />
          )}

          {accountError === 'account_inactive' && (
            <Alert 
              type="error" 
              title="Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù†Ø´Ø·" 
              message="Ø­Ø³Ø§Ø¨Ùƒ ØºÙŠØ± Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…" 
              className="mb-6"
            />
          )}

          {error && (
            <Alert 
              type="error" 
              title="ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" 
              message={error} 
              className="mb-6"
            />
          )}

          <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
            <div className="relative">
              <div className="absolute right-3 top-3 text-gray-400">
                <Mail className="w-5 h-5" />
              </div>
              <Input
                label="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                type="email"
                placeholder="you@example.com"
                error={errors.email?.message}
                {...register('email')}
                disabled={isLoading || googleLoading}
                className="bg-white/5 border-white/20 text-white pr-10"
              />
            </div>

            <div className="relative">
              <div className="absolute right-3 top-3 text-gray-400">
                <Lock className="w-5 h-5" />
              </div>
              <Input
                label="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                type="password"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                error={errors.password?.message}
                {...register('password')}
                disabled={isLoading || googleLoading}
                className="bg-white/5 border-white/20 text-white pr-10"
              />
            </div>

            <Button
              type="submit"
              className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500
                       hover:from-blue-600 hover:to-purple-600 text-white font-semibold
                       rounded-xl shadow-lg hover:shadow-xl transition-all duration-300
                       flex items-center justify-center gap-2"
              loading={isLoading}
              disabled={isLoading || googleLoading}
            >
              {isLoading ? 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...' : (
                <>
                  <LogIn className="w-5 h-5" />
                  ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </>
              )}
            </Button>
          </form>

          <div className="mt-6">
            <div className="relative">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-white/20"></div>
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-2 bg-transparent text-gray-300">Ø£Ùˆ</span>
              </div>
            </div>

            <Button
              type="button"
              onClick={handleGoogleSignIn}
              className="w-full mt-6 py-4 bg-white text-gray-900 hover:bg-gray-100
                       border border-gray-300 rounded-xl shadow-md
                       flex items-center justify-center gap-2 transition-all duration-300"
              loading={googleLoading}
              disabled={isLoading || googleLoading}
            >
              {googleLoading ? 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...' : (
                <>
                  <FcGoogle className="w-5 h-5" />
                  ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„
                </>
              )}
            </Button>
          </div>

          <div className="mt-8 pt-6 border-t border-white/20">
            <p className="text-center text-gray-300 text-sm mb-4">
              Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ{' '}
              <Link
                href="/register"
                className="font-medium text-blue-400 hover:text-blue-300 underline"
              >
                Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
              </Link>
            </p>
            <p className="text-center text-gray-300 text-sm">
              <Link
                href="/"
                className="font-medium text-blue-400 hover:text-blue-300 underline"
              >
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
              </Link>
            </p>
          </div>
        </Card>
      </div>
    </div>
  )
}

//app/dashboard/page.tsx
import { redirect } from 'next/navigation'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'

export default async function DashboardPage() {
  const session = await getServerSession(authOptions)
  
  // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ sessionØŒ Ø§Ø±Ø¬Ø¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  // Ø§Ù„Ù€ middleware Ø³ÙŠØªÙˆÙ„Ù‰ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ /login Ø¥Ø°Ø§ Ø­Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
  if (!session) {
    redirect('/')
  }
  
  const userRole = session.user.role as 'PLAYER' | 'ADMIN' | 'OWNER' | 'EMPLOYEE'
  
  // ØªÙˆØ¬ÙŠÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
  switch (userRole) {
    case 'PLAYER':
      redirect('/dashboard/player')
    case 'ADMIN':
      redirect('/dashboard/admin')
    case 'OWNER':
      redirect('/dashboard/owner')
    case 'EMPLOYEE':
      redirect('/dashboard/employee')
    default:
      redirect('/')
  }
}
//app/dashboard/layout.tsx
export default function PlayerLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="min-h-screen bg-gray-50">
      {children}
    </div>
  )
}

//app/dashboard/player/page.tsx
'use client'

import { useState, useEffect } from 'react'
import { useSession } from 'next-auth/react'
import DaySelector from '@/components/booking/day-selector'
import SlotGrid from '@/components/booking/slot-grid'
import { Day } from '@/lib/core/types'

export default function PlayerDashboard() {
  const { data: session } = useSession()
  const [selectedDate, setSelectedDate] = useState<Date>(new Date())
  const [slots, setSlots] = useState<any[]>([])
  const [field, setField] = useState<any>(null)
  const [loading, setLoading] = useState(true)
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠØ§Ù… Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù€ DaySelector
  const generateNextDays = (count: number): Day[] => {
    const days: Day[] = []
    const today = new Date()
    
    for (let i = 0; i < count; i++) {
      const date = new Date(today)
      date.setDate(today.getDate() + i)
      
      const dayOfWeek = date.getDay()
      const isWeekend = dayOfWeek === 5 || dayOfWeek === 6
      const isToday = i === 0
      const isTomorrow = i === 1
      
      // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
      const weekday = date.toLocaleDateString('ar-SA', { weekday: 'long' })
      const dayNumber = date.getDate().toString()
      const monthName = date.toLocaleDateString('ar-SA', { month: 'long' })
      
      const day: Day = {
        date: date.toISOString().split('T')[0],
        isWeekend,
        slotsAvailable: Math.floor(Math.random() * 10),
        slots: [],
        isToday,
        isTomorrow,
        weekday,
        dayNumber,
        monthName
      }
      
      days.push(day)
    }
    
    return days
  }
  
  const days = generateNextDays(10)

  useEffect(() => {
    fetchSlots()
  }, [selectedDate])

  const fetchSlots = async () => {
    try {
      setLoading(true)
      const fieldId = '1'
      
      const dateStr = selectedDate.toISOString().split('T')[0]
      const res = await fetch(`/api/fields/${fieldId}/slots?date=${dateStr}`)
      
      if (!res.ok) {
        throw new Error('Failed to fetch slots')
      }
      
      const data = await res.json()
      setSlots(data.slots || [])
      setField(data.field || null)
    } catch (error) {
      console.error('Error fetching slots:', error)
      setSlots([])
      setField(null)
    } finally {
      setLoading(false)
    }
  }

  const handleSelectDate = (date: Date) => {
    setSelectedDate(date)
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <header className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900">Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨</h1>
        <p className="text-gray-600 mt-2">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆØ­Ø¬Ø² Ù…Ù„Ø§Ø¹Ø¨Ùƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</p>
      </header>

      <div className="bg-white rounded-2xl shadow-lg p-6">
        {field && (
          <div className="mb-6">
            <h2 className="text-2xl font-bold mb-2">{field.name}</h2>
            <p className="text-gray-600">{field.description}</p>
            <div className="flex items-center gap-4 mt-3">
              <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                {field.pricePerHour} Ø¬.Ù…/Ø³Ø§Ø¹Ø©
              </span>
              <span className="text-gray-600">
                Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„: {field.openingTime} - {field.closingTime}
              </span>
            </div>
          </div>
        )}

        <DaySelector
          days={days}
          selectedDate={selectedDate}
          onSelectDate={handleSelectDate}
        />

        {loading ? (
          <div className="text-center py-12">
            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p className="mt-4 text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯...</p>
          </div>
        ) : (
          <SlotGrid
            slots={slots}
            fieldId={field?.id || ''}
            fieldName={field?.name || ''}
            userId={session?.user?.id}
          />
        )}
      </div>

      <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-white p-4 rounded-xl border">
          <h4 className="font-bold mb-2">ğŸš€ Ø­Ø¬Ø² ÙÙˆØ±ÙŠ</h4>
          <p className="text-sm text-gray-600">Ø§Ø­Ø¬Ø² ÙˆØ§Ø¯ÙØ¹ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¨Ø¹Ø¯ 24 Ø³Ø§Ø¹Ø©</p>
        </div>
        
        <div className="bg-white p-4 rounded-xl border">
          <h4 className="font-bold mb-2">â° ØªØ£ÙƒÙŠØ¯ ÙŠØ¯ÙˆÙŠ</h4>
          <p className="text-sm text-gray-600">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© ØªØ­ØªØ§Ø¬ ØªØ£ÙƒÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
        </div>
        
        <div className="bg-white p-4 rounded-xl border">
          <h4 className="font-bold mb-2">ğŸ”’ Ù‚ÙÙ„ Ø¢Ù…Ù†</h4>
          <p className="text-sm text-gray-600">Ø§Ù„Ù…ÙˆØ¹Ø¯ ÙŠØ¨Ù‚Ù‰ Ù…Ù‚ÙÙˆÙ„ Ù„Ùƒ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­Ø¬Ø²</p>
        </div>
      </div>
    </div>
  )
}

// app/dashboard/player/layout.tsx
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'
import { redirect } from 'next/navigation'

export default async function PlayerLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const session = await getServerSession(authOptions)
  
  if (!session) {
    redirect('/login?redirect=/dashboard/player')
  }
  
  if (session.user.role !== 'PLAYER') {
    redirect('/dashboard')
  }
  
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="bg-white shadow-sm border-b">
        <div className="container mx-auto px-4 py-4">
          <div className="flex justify-between items-center">
            <h1 className="text-xl font-bold text-gray-900">Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨</h1>
            <div className="text-sm text-gray-600">
              Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span className="font-semibold">{session.user.name}</span>
            </div>
          </div>
        </div>
      </div>
      {children}
    </div>
  )
}

// app/dashboard/owner/page.tsx
'use client'

export default function OwnerDashboard() {
  return (
    <div className="p-6">
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div className="bg-white rounded-xl shadow p-6">
          <h3 className="text-xl font-bold mb-4 text-gray-800">ğŸ’° Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>
          <div className="text-3xl font-bold text-green-600">25,000 Ø¬.Ù…</div>
          <p className="text-gray-500 text-sm mt-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>
        
        <div className="bg-white rounded-xl shadow p-6">
          <h3 className="text-xl font-bold mb-4 text-gray-800">ğŸ¾ Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨</h3>
          <div className="text-3xl font-bold text-blue-600">8</div>
          <p className="text-gray-500 text-sm mt-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù†Ø´Ø·Ø©</p>
        </div>
        
        <div className="bg-white rounded-xl shadow p-6">
          <h3 className="text-xl font-bold mb-4 text-gray-800">ğŸ“Š Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h3>
          <div className="text-3xl font-bold text-purple-600">142</div>
          <p className="text-gray-500 text-sm mt-2">Ø­Ø¬Ø² ÙØ¹Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>
      </div>
      
      <div className="mt-8 bg-white rounded-xl shadow p-6">
        <h3 className="text-xl font-bold mb-4 text-gray-800">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
        <p className="text-gray-600">
          Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ù…Ø§Ù„Ùƒ
        </p>
      </div>
    </div>
  )
}

// app/dashboard/owner/layout.tsx
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'
import { redirect } from 'next/navigation'

export default async function OwnerLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const session = await getServerSession(authOptions)
  
  if (!session) {
    redirect('/login?redirect=/dashboard/owner')
  }
  
  if (session.user.role !== 'OWNER') {
    redirect('/dashboard')
  }
  
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="border-b bg-white py-4 px-6">
        <h1 className="text-2xl font-bold text-gray-900">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø§Ù„Ùƒ</h1>
        <p className="text-gray-600">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {session.user.name}</p>
      </div>
      {children}
    </div>
  )
}

// app/dashboard/employee/page.tsx
'use client'

import { useState } from 'react'

export default function EmployeeDashboard() {
  const [pendingTasks] = useState([
    { id: 1, title: 'ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø± Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', time: '10:00 ØµØ¨Ø§Ø­Ø§Ù‹' },
    { id: 2, title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø¯ÙØ¹ Ø£Ø­Ù…Ø¯', time: '11:30 ØµØ¨Ø§Ø­Ø§Ù‹' },
    { id: 3, title: 'Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙˆÙ„Ø© Ø­Ø¬Ø²', time: '01:00 Ø¸Ù‡Ø±Ø§Ù‹' },
  ])

  const [customerQueries] = useState([
    { id: 1, name: 'Ø¹Ù…Ø± Ù…Ø­Ù…Ø¯', question: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø®ØµÙ… Ù„Ù„ÙØ±Ù‚ØŸ', time: 'Ø£Ù…Ø³' },
    { id: 2, name: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', question: 'ÙƒÙ… Ø³Ø¹Ø± Ø³Ø§Ø¹Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©ØŸ', time: 'Ù…Ù†Ø° Ø³Ø§Ø¹ØªÙŠÙ†' },
  ])

  return (
    <div className="p-6">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© */}
        <div className="bg-white rounded-xl shadow p-6">
          <h3 className="text-xl font-bold mb-4 text-gray-800">ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h3>
          <div className="space-y-4">
            {pendingTasks.map(task => (
              <div key={task.id} className="border rounded-lg p-4 hover:bg-gray-50 transition">
                <div className="flex justify-between items-center">
                  <h4 className="font-medium text-gray-800">{task.title}</h4>
                  <span className="text-sm text-gray-500">{task.time}</span>
                </div>
                <div className="mt-2 flex gap-2">
                  <button className="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-lg hover:bg-green-200 transition">
                    ØªØ£ÙƒÙŠØ¯
                  </button>
                  <button className="px-3 py-1 bg-red-100 text-red-800 text-sm rounded-lg hover:bg-red-200 transition">
                    Ø¥Ù„ØºØ§Ø¡
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ */}
        <div className="bg-white rounded-xl shadow p-6">
          <h3 className="text-xl font-bold mb-4 text-gray-800">ğŸ“ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
          <div className="space-y-4">
            {customerQueries.map(query => (
              <div key={query.id} className="border rounded-lg p-4 hover:bg-gray-50 transition">
                <div className="flex justify-between items-start">
                  <div>
                    <h4 className="font-medium text-gray-800">{query.name}</h4>
                    <p className="text-gray-600 text-sm mt-1">{query.question}</p>
                  </div>
                  <span className="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
                    {query.time}
                  </span>
                </div>
                <div className="mt-3">
                  <textarea 
                    className="w-full border rounded-lg p-2 text-sm"
                    rows={2}
                    placeholder="Ø£ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù‡Ù†Ø§..."
                  />
                  <button className="mt-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition">
                    Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}
// app/dashboard/employee/layout.tsx
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'
import { redirect } from 'next/navigation'

export default async function EmployeeLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const session = await getServerSession(authOptions)
  
  if (!session) {
    redirect('/login?redirect=/dashboard/employee')
  }
  
  if (session.user.role !== 'EMPLOYEE') {
    redirect('/dashboard')
  }
  
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="border-b bg-white py-4 px-6">
        <h1 className="text-2xl font-bold text-gray-900">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ¸Ù</h1>
        <p className="text-gray-600">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {session.user.name}</p>
      </div>
      {children}
    </div>
  )
}

// app/dashboard/admin/page.tsx
export default function AdminPage() {
  return (
    <div className="p-6">
      <h1 className="text-3xl font-bold mb-6 text-gray-900">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
      
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div className="bg-white p-6 rounded-xl shadow">
          <h3 className="text-lg font-semibold mb-2">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</h3>
          <p className="text-2xl font-bold">1,248</p>
          <p className="text-sm text-gray-500">Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø´Ø·</p>
        </div>
        
        <div className="bg-white p-6 rounded-xl shadow">
          <h3 className="text-lg font-semibold mb-2">ğŸŸï¸ Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨</h3>
          <p className="text-2xl font-bold">42</p>
          <p className="text-sm text-gray-500">Ù…Ù„Ø¹Ø¨ Ù…Ø³Ø¬Ù„</p>
        </div>
        
        <div className="bg-white p-6 rounded-xl shadow">
          <h3 className="text-lg font-semibold mb-2">ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h3>
          <p className="text-2xl font-bold">3,847</p>
          <p className="text-sm text-gray-500">Ø­Ø¬Ø² Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>
        
        <div className="bg-white p-6 rounded-xl shadow">
          <h3 className="text-lg font-semibold mb-2">ğŸ’° Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯</h3>
          <p className="text-2xl font-bold">125,000 Ø¬.Ù…</p>
          <p className="text-sm text-gray-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</p>
        </div>
      </div>
      
      <div className="bg-white rounded-xl shadow p-6">
        <h2 className="text-xl font-bold mb-4">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <button className="p-4 border rounded-lg hover:bg-gray-50 transition text-right">
            <h4 className="font-semibold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h4>
            <p className="text-sm text-gray-600">Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
          </button>
          
          <button className="p-4 border rounded-lg hover:bg-gray-50 transition text-right">
            <h4 className="font-semibold">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
            <p className="text-sm text-gray-600">Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
          </button>
          
          <button className="p-4 border rounded-lg hover:bg-gray-50 transition text-right">
            <h4 className="font-semibold">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
            <p className="text-sm text-gray-600">ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø©</p>
          </button>
        </div>
      </div>
    </div>
  )
}

// app/dashboard/admin/layout.tsx
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/infrastructure/auth/auth-options'
import { redirect } from 'next/navigation'

export default async function AdminLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const session = await getServerSession(authOptions)
  
  if (!session) {
    redirect('/login?redirect=/dashboard/admin')
  }
  
  if (session.user.role !== 'ADMIN') {
    redirect('/dashboard')
  }
  
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="border-b bg-white py-4 px-6">
        <h1 className="text-2xl font-bold text-gray-900">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
        <p className="text-gray-600">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {session.user.name}</p>
      </div>
      {children}
    </div>
  )
}

// lib/infrastructure/auth/auth-options.ts
import { NextAuthOptions } from 'next-auth'
import CredentialsProvider from 'next-auth/providers/credentials'
import GoogleProvider from 'next-auth/providers/google'
import { RateLimiterMemory } from 'rate-limiter-flexible'
import { prisma } from '@/lib/infrastructure/database/prisma'
import { comparePassword } from '@/lib/infrastructure/security/password'
import { z } from 'zod'
import { authLogger } from '@/lib/shared/logger'
import { Role, SkillLevel } from '@prisma/client'
import { ENV } from '@/lib/shared/env/env'

// Rate Limiter
const loginRateLimiter = new RateLimiterMemory({
  points: 5,
  duration: 15 * 60,
})

const loginSchema = z.object({
  email: z.string().email('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­'),
  password: z.string().min(1, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©')
})

const normalizeEmail = (email: string): string => {
  return email.toLowerCase().trim()
}

export const authOptions: NextAuthOptions = {
  providers: [
    CredentialsProvider({
      name: 'credentials',
      credentials: {
        email: { label: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', type: 'email' },
        password: { label: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', type: 'password' }
      },
      async authorize(credentials) { // âœ… Ø¥Ø²Ø§Ù„Ø© req Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹
        try {
          await loginRateLimiter.consume(credentials?.email || 'unknown')
          
          const validated = loginSchema.parse(credentials)
          const normalizedEmail = normalizeEmail(validated.email)

          const user = await prisma.user.findUnique({
            where: { email: normalizedEmail }
          })

          if (!user) {
            authLogger.warn({ email: normalizedEmail }, 'User not found')
            throw new Error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©')
          }

          if (!user.isActive) {
            authLogger.warn({ userId: user.id }, 'Inactive account attempt')
            throw new Error('Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù†Ø´Ø·')
          }

          if (user.lockedUntil && user.lockedUntil > new Date()) {
            authLogger.warn({ userId: user.id }, 'Locked account attempt')
            throw new Error('Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¤Ù‚Øª Ù…ØºÙ„Ù‚ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹')
          }

          if (!user.passwordHash) {
            authLogger.warn({ userId: user.id }, 'No password hash for credentials login')
            throw new Error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©')
          }

          const isValid = await comparePassword(validated.password, user.passwordHash)
          
          if (!isValid) {
            await prisma.user.update({
              where: { id: user.id },
              data: {
                loginAttempts: { increment: 1 },
                ...(user.loginAttempts + 1 >= 5 ? {
                  lockedUntil: new Date(Date.now() + 15 * 60 * 1000)
                } : {})
              }
            })
            authLogger.warn({ userId: user.id }, 'Invalid password attempt')
            throw new Error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©')
          }

          await prisma.user.update({
            where: { id: user.id },
            data: {
              loginAttempts: 0,
              lockedUntil: null,
              lastLogin: new Date()
            }
          })

          authLogger.info({ userId: user.id }, 'User authenticated successfully')
          
          // âœ… Ø¥Ø±Ø¬Ø§Ø¹ ÙƒØ§Ø¦Ù† User Ù…Ø¨Ø³Ø·
          return {
            id: user.id,
            name: user.name,
            email: user.email,
            role: user.role,
            phoneNumber: user.phoneNumber,
            age: user.age ? Number(user.age) : null,
            skillLevel: user.skillLevel,
            isActive: user.isActive,
            isVerified: user.isVerified,
            lastLogin: user.lastLogin
          }

        } catch (error: any) {
          if (error instanceof Error && error.message.includes('RateLimiter')) {
            authLogger.warn({ email: credentials?.email }, 'Rate limit exceeded')
            throw new Error('Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª')
          }
          authLogger.error({ error }, 'Authentication error')
          throw new Error(error.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')
        }
      }
    }),

    GoogleProvider({
      clientId: ENV.GOOGLE_CLIENT_ID || '',
      clientSecret: ENV.GOOGLE_CLIENT_SECRET || '',
      authorization: {
        params: {
          prompt: "consent",
          access_type: "offline",
          response_type: "code",
          scope: "openid email profile"
        }
      },
      async profile(profile) { // âœ… Ø¥Ø²Ø§Ù„Ø© tokens Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹
        const normalizedEmail = normalizeEmail(profile.email)
        
        try {
          let user = await prisma.user.findUnique({
            where: { email: normalizedEmail }
          })

          if (!user) {
            user = await prisma.user.create({
              data: {
                email: normalizedEmail,
                name: profile.name || profile.email.split('@')[0],
                passwordHash: null,
                phoneNumber: null,
                age: null,
                skillLevel: 'AVERAGE',
                role: 'PLAYER',
                isActive: true,
                isVerified: true,
                lastLogin: new Date()
              }
            })
            authLogger.info({ userId: user.id }, 'New OAuth user created')
          } else {
            await prisma.user.update({
              where: { id: user.id },
              data: { 
                lastLogin: new Date(),
                name: profile.name || user.name
              }
            })
          }

          if (!user.isActive) {
            authLogger.warn({ userId: user.id }, 'Inactive OAuth account')
            throw new Error('Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù†Ø´Ø·')
          }

          authLogger.info({ userId: user.id }, 'OAuth user authenticated')
          
          // âœ… Ø¥Ø±Ø¬Ø§Ø¹ ÙƒØ§Ø¦Ù† User Ù…Ø¨Ø³Ø·
          return {
            id: user.id,
            name: user.name,
            email: user.email,
            role: user.role,
            phoneNumber: user.phoneNumber,
            age: user.age ? Number(user.age) : null,
            skillLevel: user.skillLevel,
            isActive: user.isActive,
            isVerified: user.isVerified,
            lastLogin: user.lastLogin
          }
        } catch (error: any) {
          authLogger.error({ error }, 'OAuth profile error')
          throw error
        }
      }
    })
  ],

  session: {
    strategy: 'jwt',
    maxAge: 30 * 24 * 60 * 60,
  },

  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.id = user.id
        token.role = user.role
        token.phoneNumber = user.phoneNumber
        token.age = user.age
        token.skillLevel = user.skillLevel
        token.isActive = user.isActive
        token.isVerified = user.isVerified
        token.lastLogin = user.lastLogin
      }
      return token
    },

    async session({ session, token }) {
      if (session.user) {
        session.user.id = token.id as string
        session.user.role = token.role as Role
        session.user.phoneNumber = token.phoneNumber as string | null
        session.user.age = token.age as number | null
        session.user.skillLevel = token.skillLevel as SkillLevel
        session.user.isActive = token.isActive as boolean
        session.user.isVerified = token.isVerified as boolean
        session.user.lastLogin = token.lastLogin as Date | null
      }
      return session
    },

    async redirect({ url, baseUrl }) {
      if (url.startsWith('/')) {
        return `${baseUrl}${url}`
      } else if (new URL(url).origin === baseUrl) {
        return url
      }
      return baseUrl
    }
  },

  pages: {
    signIn: '/login',
    signOut: '/login',
    error: '/login'
  },

  debug: ENV.NODE_ENV === 'development',
  secret: ENV.NEXTAUTH_SECRET
}

// âœ… Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
declare module 'next-auth' {
  interface User {
    id: string
    role: Role
    phoneNumber: string | null
    age: number | null
    skillLevel: SkillLevel
    isActive: boolean
    isVerified: boolean
    lastLogin: Date | null
  }
  
  interface Session {
    user: User
  }
}

declare module 'next-auth/jwt' {
  interface JWT {
    id?: string
    role?: Role
    phoneNumber?: string | null
    age?: number | null
    skillLevel?: SkillLevel
    isActive?: boolean
    isVerified?: boolean
    lastLogin?: Date | null
  }
}

// lib/infrastructure/auth/errors.ts
import { z } from 'zod'
import { authLogger } from '@/lib/shared/logger'

export class AppError extends Error {
  constructor(
    public message: string,
    public statusCode: number = 500,
    public errorCode?: string,
    public details?: unknown
  ) {
    super(message)
    this.name = this.constructor.name
    Error.captureStackTrace(this, this.constructor)
    authLogger.error({ statusCode, errorCode, details }, `AppError: ${message}`)
  }
}

export class ValidationError extends AppError {
  constructor(message: string, details?: unknown) {
    super(message, 400, 'VALIDATION_ERROR', details)
  }
}

export class AuthenticationError extends AppError {
  constructor(message = 'Authentication required') {
    super(message, 401, 'AUTHENTICATION_ERROR')
  }
}

export class AuthorizationError extends AppError {
  constructor(message = 'Insufficient permissions') {
    super(message, 403, 'AUTHORIZATION_ERROR')
  }
}

export class NotFoundError extends AppError {
  constructor(resource = 'Resource') {
    super(`${resource} not found`, 404, 'NOT_FOUND')
  }
}

export class ConflictError extends AppError {
  constructor(message = 'Resource already exists') {
    super(message, 409, 'CONFLICT')
  }
}

export class RateLimitError extends AppError {
  constructor(message = 'Too many requests') {
    super(message, 429, 'RATE_LIMIT_EXCEEDED')
  }
}

export class TokenExpiredError extends AppError {
  constructor(message = 'Token has expired') {
    super(message, 401, 'TOKEN_EXPIRED')
  }
}

export class InvalidTokenError extends AppError {
  constructor(message = 'Invalid token') {
    super(message, 401, 'INVALID_TOKEN')
  }
}

// Error handler
export const handleError = (error: unknown): AppError => {
  if (error instanceof AppError) {
    return error
  }
  
  if (error instanceof z.ZodError) {
    return new ValidationError(
      'Validation failed',
      error.issues.map((e: z.ZodIssue) => ({
        path: e.path.join('.'),
        message: e.message
      }))
    )
  }
  
  authLogger.error({ error }, 'Unexpected error')
  
  return new AppError(
    'An unexpected error occurred',
    500,
    'INTERNAL_SERVER_ERROR'
  )
}

// lib/infrastructure/auth/responses.ts
export interface ApiResponse<T = any> {
  success: boolean
  message: string
  data?: T
  errorCode?: string
  details?: any
  timestamp: string
  path?: string
}

export const successResponse = <T>(
  message: string, 
  data?: T,
  path?: string
): ApiResponse<T> => ({
  success: true,
  message,
  data,
  timestamp: new Date().toISOString(),
  path
})

export const errorResponse = (
  message: string,
  errorCode?: string,
  details?: any,
  path?: string
): ApiResponse => ({
  success: false,
  message,
  errorCode,
  details,
  timestamp: new Date().toISOString(),
  path
})

export const validationErrorResponse = (
  errors: any[],
  path?: string
): ApiResponse => ({
  success: false,
  message: 'Validation failed',
  errorCode: 'VALIDATION_ERROR',
  details: { errors },
  timestamp: new Date().toISOString(),
  path
})

// lib/infrastructure/auth/validators.ts
import { z } from 'zod'

export const emailSchema = z.string()
  .email('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­')
  .min(1, 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨')
  .max(100, 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹')

export const passwordSchema = z.string()
  .min(6, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
  .max(72, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹')

export const nameSchema = z.string()
  .min(2, 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
  .max(100, 'Ø§Ù„Ø§Ø³Ù… Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹')
  .regex(/^[a-zA-Z\u0600-\u06FF\s]*$/, 'Ø§Ù„Ø§Ø³Ù… ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØ­ØªÙˆÙŠ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù ÙˆÙ…Ø³Ø§ÙØ§Øª')

export const phoneSchema = z.string()
  .min(10, 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
  .max(15, 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹')
  .regex(/^[0-9+\-\s()]*$/, 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­')

export const ageSchema = z.number()
  .min(13, 'Ø§Ù„Ø¹Ù…Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 13 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
  .max(100, 'Ø§Ù„Ø¹Ù…Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 100 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø±')

export const skillLevelSchema = z.enum(['WEAK', 'AVERAGE', 'GOOD', 'EXCELLENT', 'LEGENDARY'])

export const registerSchema = z.object({
  name: nameSchema,
  email: emailSchema,
  password: passwordSchema,
  confirmPassword: z.string(),
  phoneNumber: phoneSchema,
  age: ageSchema,
  description: z.string().max(500, 'Ø§Ù„ÙˆØµÙ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ (500 Ø­Ø±Ù ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)').optional(),
  skillLevel: skillLevelSchema
}).refine(data => data.password === data.confirmPassword, {
  message: "ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©",
  path: ["confirmPassword"]
})

export const loginSchema = z.object({
  email: emailSchema,
  password: z.string().min(1, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©')
})

export const updateProfileSchema = z.object({
  name: nameSchema.optional(),
  email: emailSchema.optional(),
  phoneNumber: phoneSchema.optional(),
  age: ageSchema.optional(),
  description: z.string().max(500).optional(),
  skillLevel: skillLevelSchema.optional()
}).refine(data => Object.keys(data).length > 0, {
  message: "ÙŠØ¬Ø¨ ØªÙ‚Ø¯ÙŠÙ… Ø­Ù‚Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
})

export const changePasswordSchema = z.object({
  currentPassword: z.string().min(1, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©'),
  newPassword: passwordSchema,
  confirmPassword: z.string()
}).refine(data => data.newPassword === data.confirmPassword, {
  message: "ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©",
  path: ["confirmPassword"]
})

export type RegisterInput = z.infer<typeof registerSchema>
export type LoginInput = z.infer<typeof loginSchema>
export type UpdateProfileInput = z.infer<typeof updateProfileSchema>
export type ChangePasswordInput = z.infer<typeof changePasswordSchema>
export type RegisterFormInput = RegisterInput & {
  skillLevel: 'WEAK' | 'AVERAGE' | 'GOOD' | 'EXCELLENT' | 'LEGENDARY'
}
//components/providers/Authprovider.tsx
'use client'

import { SessionProvider } from 'next-auth/react'

export default function AuthProvider({ 
  children 
}: { 
  children: React.ReactNode 
}) {
  return <SessionProvider>{children}</SessionProvider>
}
//components/providers/session-provider.tsx

'use client'

import { SessionProvider } from "next-auth/react"

export function AuthProvider({ children }: { children: React.ReactNode }) {
  return <SessionProvider>{children}</SessionProvider>
}

// middleware.ts
import { NextRequest, NextResponse } from 'next/server'
import { getToken } from 'next-auth/jwt'

export default async function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl
  
  console.log('ğŸ“Œ [MIDDLEWARE]', { pathname, url: request.url })
  
  // 1ï¸âƒ£ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù€ SECRET Ø£ÙˆÙ„Ø§Ù‹
  if (!process.env.NEXTAUTH_SECRET) {
    console.error('âŒ [MIDDLEWARE ERROR] NEXTAUTH_SECRET is not defined')
    
    if (process.env.NODE_ENV === 'production') {
      return new NextResponse('Server configuration error', { 
        status: 500,
        headers: { 'Content-Type': 'text/plain' }
      })
    }
    
    return new NextResponse(
      'NEXTAUTH_SECRET is missing. Add to .env.local:\n' +
      'NEXTAUTH_SECRET=$(openssl rand -base64 32)',
      { 
        status: 500,
        headers: { 'Content-Type': 'text/plain' }
      }
    )
  }
  
  // 2ï¸âƒ£ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ©
  if (
    pathname.startsWith('/_next') ||
    pathname.startsWith('/api/_next') ||
    pathname.includes('.') ||
    pathname === '/favicon.ico' ||
    pathname.startsWith('/api/health')
  ) {
    return NextResponse.next()
  }
  
  // 3ï¸âƒ£ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ token
  const token = await getToken({ 
    req: request, 
    secret: process.env.NEXTAUTH_SECRET
  })
  
  console.log('ğŸ”‘ [TOKEN]', { hasToken: !!token, pathname })
  
  // 4ï¸âƒ£ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
  const publicPaths = ['/', '/login', '/register', '/about', '/contact']
  const isPublicPath = publicPaths.includes(pathname) || 
                      pathname.startsWith('/api/auth')
  
  // 5ï¸âƒ£ Ø­Ù…Ø§ÙŠØ© Ù…Ø³Ø§Ø±Ø§Øª /dashboard ÙÙ‚Ø· (ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)
  const isDashboardPath = pathname.startsWith('/dashboard')
  
  // Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
  if (isPublicPath) {
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ ÙˆÙŠØ­Ø§ÙˆÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ /login Ø£Ùˆ /register
    if (token && (pathname === '/login' || pathname === '/register')) {
      console.log('ğŸ”„ Redirecting logged user from login to dashboard')
      return NextResponse.redirect(new URL('/dashboard', request.url))
    }
    return NextResponse.next()
  }
  
  // Ø­Ù…Ø§ÙŠØ© Ù…Ø³Ø§Ø±Ø§Øª /dashboard
  if (isDashboardPath && !token) {
    console.log('ğŸ”’ Unauthenticated access to dashboard path:', pathname)
    const loginUrl = new URL('/login', request.url)
    loginUrl.searchParams.set('redirect', pathname)
    return NextResponse.redirect(loginUrl)
  }
  
  // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¨Ø§Ù‚ÙŠ
  return NextResponse.next()
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico).*)',
  ],
}
